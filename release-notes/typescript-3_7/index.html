<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/typescript/umi.8c6752e0.css" />
    <script>
      window.routerBase = "/typescript/";
    </script>
    <script>
      //! umi version: 3.5.20
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>TypeScript 3.7 - TypeScript手册</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/release-notes/typescript-3_7" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/typescript//">TypeScript手册</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/typescript//tutorials">介绍</a></span><span><a href="/typescript//handbook">基础</a></span><span><a href="/typescript//reference">进阶</a></span><span><a href="/typescript//handbook-v2">字面量类型</a></span><span><a href="/typescript//declaration-files">声明文件</a></span><span><a href="/typescript//javascript">类型检查-JS</a></span><span><a href="/typescript//project-config">工程配置</a></span><span><a href="/typescript//wiki">Wiki</a></span><span><a aria-current="page" class="active" href="/typescript//release-notes">新增</a></span><span><a href="/typescript//breaking-changes">改动</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/onlyxhb/typescript">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/typescript//"></a><h1>TypeScript手册</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/typescript//tutorials">介绍</a></li><li><a href="/typescript//handbook">基础</a></li><li><a href="/typescript//reference">进阶</a></li><li><a href="/typescript//handbook-v2">字面量类型</a></li><li><a href="/typescript//declaration-files">声明文件</a></li><li><a href="/typescript//javascript">类型检查-JS</a></li><li><a href="/typescript//project-config">工程配置</a></li><li><a href="/typescript//wiki">Wiki</a></li><li><a aria-current="page" class="active" href="/typescript//release-notes">新增</a></li><li><a href="/typescript//breaking-changes">改动</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/onlyxhb/typescript">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/typescript//release-notes">新增</a></li><li><a href="/typescript//release-notes/typescript-1_1">TypeScript 1.1</a></li><li><a href="/typescript//release-notes/typescript-1_3">TypeScript 1.3</a></li><li><a href="/typescript//release-notes/typescript-1_4">TypeScript 1.4</a></li><li><a href="/typescript//release-notes/typescript-1_5">TypeScript 1.5</a></li><li><a href="/typescript//release-notes/typescript-1_6">TypeScript 1.6</a></li><li><a href="/typescript//release-notes/typescript-1_7">TypeScript 1.7</a></li><li><a href="/typescript//release-notes/typescript-1_8">TypeScript 1.8</a></li><li><a href="/typescript//release-notes/typescript-2_0">TypeScript 2.0</a></li><li><a href="/typescript//release-notes/typescript-2_1">TypeScript 2.1</a></li><li><a href="/typescript//release-notes/typescript-2_2">TypeScript 2.2</a></li><li><a href="/typescript//release-notes/typescript-2_3">TypeScript 2.3</a></li><li><a href="/typescript//release-notes/typescript-2_4">TypeScript 2.4</a></li><li><a href="/typescript//release-notes/typescript-2_5">TypeScript 2.5</a></li><li><a href="/typescript//release-notes/typescript-2_6">TypeScript 2.6</a></li><li><a href="/typescript//release-notes/typescript-2_7">TypeScript 2.7</a></li><li><a href="/typescript//release-notes/typescript-2_8">TypeScript 2.8</a></li><li><a href="/typescript//release-notes/typescript-2_9">TypeScript 2.9</a></li><li><a href="/typescript//release-notes/typescript-3_0">TypeScript 3.0</a></li><li><a href="/typescript//release-notes/typescript-3_1">TypeScript 3.1</a></li><li><a href="/typescript//release-notes/typescript-3_2">TypeScript 3.2</a></li><li><a href="/typescript//release-notes/typescript-3_3">TypeScript 3.3</a></li><li><a href="/typescript//release-notes/typescript-3_4">TypeScript 3.4</a></li><li><a href="/typescript//release-notes/typescript-3_5">TypeScript 3.5</a></li><li><a href="/typescript//release-notes/typescript-3_6">TypeScript 3.6</a></li><li><a aria-current="page" class="active" href="/typescript//release-notes/typescript-3_7">TypeScript 3.7</a></li><li><a href="/typescript//release-notes/typescript-3_8">TypeScript 3.8</a></li><li><a href="/typescript//release-notes/typescript-3_9">TypeScript 3.9</a></li><li><a href="/typescript//release-notes/typescript-4_0">TypeScript 4.0</a></li><li><a href="/typescript//release-notes/typescript-4_1">TypeScript 4.1</a></li><li><a href="/typescript//release-notes/typescript-4_2">TypeScript 4.2</a></li><li><a href="/typescript//release-notes/typescript-4_3">TypeScript 4.3</a></li><li><a href="/typescript//release-notes/typescript-4_4">TypeScript 4.4</a></li><li><a href="/typescript//release-notes/typescript-4_5">TypeScript 4.5</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="可选链（Optional Chaining）" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#可选链optional-chaining"><span>可选链（Optional Chaining）</span></a></li><li title="空值合并（Nullish Coalescing）" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#空值合并nullish-coalescing"><span>空值合并（Nullish Coalescing）</span></a></li><li title="断言函数" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#断言函数"><span>断言函数</span></a></li><li title="更好地支持返回 never 的函数" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#更好地支持返回-never-的函数"><span>更好地支持返回 never 的函数</span></a></li><li title="（更加）递归的类型别名" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#更加递归的类型别名"><span>（更加）递归的类型别名</span></a></li><li title="--declaration 和 --allowJs" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#--declaration-和---allowjs"><span>--declaration 和 --allowJs</span></a></li><li title="useDefineForClassFields 编译选项和 declare 属性修饰符" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#usedefineforclassfields-编译选项和-declare-属性修饰符"><span>useDefineForClassFields 编译选项和 declare 属性修饰符</span></a></li><li title="利用项目引用实现无构建编辑" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#利用项目引用实现无构建编辑"><span>利用项目引用实现无构建编辑</span></a></li><li title="检查未调用的函数" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#检查未调用的函数"><span>检查未调用的函数</span></a></li><li title="TypeScript 文件中的 // @ts-nocheck" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#typescript-文件中的--ts-nocheck"><span>TypeScript 文件中的 // @ts-nocheck</span></a></li><li title="分号格式化选项" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#分号格式化选项"><span>分号格式化选项</span></a></li><li title="3.7 的破坏性变更" data-depth="2"><a href="/typescript//release-notes/typescript-3_7#37-的破坏性变更"><span>3.7 的破坏性变更</span></a></li><li title="DOM 变更" data-depth="3"><a href="/typescript//release-notes/typescript-3_7#dom-变更"><span>DOM 变更</span></a></li><li title="类字段处理" data-depth="3"><a href="/typescript//release-notes/typescript-3_7#类字段处理"><span>类字段处理</span></a></li><li title="函数真值检查" data-depth="3"><a href="/typescript//release-notes/typescript-3_7#函数真值检查"><span>函数真值检查</span></a></li><li title="本地和导入的类型声明现在会产生冲突" data-depth="3"><a href="/typescript//release-notes/typescript-3_7#本地和导入的类型声明现在会产生冲突"><span>本地和导入的类型声明现在会产生冲突</span></a></li><li title="3.7 API 变化" data-depth="3"><a href="/typescript//release-notes/typescript-3_7#37-api-变化"><span>3.7 API 变化</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="typescript-37"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#typescript-37"><span class="icon icon-link"></span></a>TypeScript 3.7</h1><h2 id="可选链optional-chaining"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#可选链optional-chaining"><span class="icon icon-link"></span></a>可选链（Optional Chaining）</h2><p><a target="_blank" rel="noopener noreferrer" href="http://www.typescriptlang.org/play/#example/optional-chaining">Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>在我们的 issue 列表上，可选链是 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/issues/16">issue #16<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。感受一下，从那之后 TypeScript 的 issue 列表中新增了 23,000 条 issues。</p><p>可选链的核心是，在我们编写代码中，当遇到 <code>null</code> 或 <code>undefined</code>，TypeScript 可以立即停止解析一部分表达式。 可选链的关键点是一个为 <em>可选属性访问</em> 提供的新的运算符 <code>?.</code>。 比如我们可以这样写代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> foo</span><span class="token operator">?.</span><span class="token plain">bar</span><span class="token punctuation">.</span><span class="token method function property-access">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>意思是，当 <code>foo</code> 有定义时，执行 <code>foo.bar.baz()</code> 的计算；但是当 <code>foo</code> 是 <code>null</code> 或 <code>undefined</code> 时，停止后续的解析，直接返回 <code>undefined</code>。</p><p>更明确地说，上面的代码和下面的代码等价。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword nil">undefined</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    foo</span><span class="token punctuation">.</span><span class="token property-access">bar</span><span class="token punctuation">.</span><span class="token method function property-access">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>注意，当 <code>bar</code> 是 <code>null</code> 或 <code>undefined</code>，我们的代码访问 <code>baz</code> 依然会报错。 同理，当 <code>baz</code> 是 <code>null</code> 或 <code>undefined</code>，在调用时也会报错。<code>?.</code> 只检查它 <em>左边</em> 的值是不是 <code>null</code> 或 <code>undefined</code>，不检查后续的属性。</p><p>你会发现自己可以使用 <code>?.</code> 来替换用了 <code>&amp;&amp;</code> 的大量空值检查代码。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 以前</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">&amp;&amp;</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token property-access">bar</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token property-access">bar</span><span class="token punctuation">.</span><span class="token property-access">baz</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 以后</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo</span><span class="token operator">?.</span><span class="token plain">bar</span><span class="token operator">?.</span><span class="token plain">baz</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>注意，<code>?.</code> 与 <code>&amp;&amp;</code> 的行为略有不同，因为 <code>&amp;&amp;</code> 会作用在所有“假”值上（例如，空字符串、<code>0</code>、<code>NaN</code> 以及 <code>false</code>），但 <code>?.</code> 是一个仅作用于结构上的特性。 它不会在有效数据（比如 <code>0</code> 或空字符串）上进行短路计算。</p><p>可选链还包括两个另外的用法。 首先是 <em>可选元素访问</em>，表现类似于可选属性访问，但是也允许我们访问非标识符属性（例如：任意字符串、数字和 symbol）：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * 如果 arr 是一个数组，返回第一个元素</span></div><div class="token-line"><span class="token comment"> * 否则返回 undefined</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token generic-function function">tryGetFirstElement</span><span class="token generic-function generic class-name operator">&lt;</span><span class="token generic-function generic class-name constant">T</span><span class="token generic-function generic class-name operator">&gt;</span><span class="token punctuation">(</span><span class="token plain">arr</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> arr</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 等价于：</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//   return (arr === null || arr === undefined) ?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//       undefined :</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//       arr[0];</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>另一个是 <em>可选调用</em>，判断条件是当该表达式不是 <code>null</code> 或 <code>undefined</code>，我们就可以调用它。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> log</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    log</span><span class="token operator">?.</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Request started at </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name known-class-name class-name">Date</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation method function property-access">toISOString</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 基本等价于：</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//   if (log != null) {</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//       log(`Request started at ${new Date().toISOString()}`);</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//   }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    log</span><span class="token operator">?.</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Request finished at at </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name known-class-name class-name">Date</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation method function property-access">toISOString</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>可选链的“短路计算”行为仅限于属性访问、调用、元素访问——它不会延伸到后续的表达式中。 也就是说，</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> foo</span><span class="token operator">?.</span><span class="token plain">bar </span><span class="token operator">/</span><span class="token plain"> </span><span class="token function">someComputation</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></pre></div><p>可选链不会阻止除法运算或 <code>someComputation()</code> 的进行。 上面这段代码实际上等价于：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> temp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> foo </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword nil">undefined</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    foo</span><span class="token punctuation">.</span><span class="token property-access">bar</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> temp </span><span class="token operator">/</span><span class="token plain"> </span><span class="token function">someComputation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>当然，这可能会使得 <code>undefined</code> 参与了除法运算，导致在 <code>strictNullChecks</code> 编译选项下产生报错。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">barPercentage</span><span class="token punctuation">(</span><span class="token plain">foo</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> bar</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> foo</span><span class="token operator">?.</span><span class="token plain">bar </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//     ~~~~~~~~</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// Error: Object is possibly undefined.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>想了解更多细节，你可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/tc39/proposal-optional-chaining/">检阅完整的草案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 以及 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/33294">查看原始的 PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="空值合并nullish-coalescing"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#空值合并nullish-coalescing"><span class="icon icon-link"></span></a>空值合并（Nullish Coalescing）</h2><p><a target="_blank" rel="noopener noreferrer" href="http://www.typescriptlang.org/play/#example/nullish-coalescing">Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><em>空值合并运算符</em> 是另一个即将到来的 ECMAScript 特性（与可选链一起），我们的团队也参与了 TC39 的的讨论工作。</p><p>你可以考虑使用 <code>??</code> 运算符来实现：当字段是 <code>null</code> 或 <code>undefined</code> 时，“回退”到默认值。 比如我们可以这样写代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> foo </span><span class="token operator">??</span><span class="token plain"> </span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>这种新方式的意思是，当 <code>foo</code> “存在”时 x 等于 foo； 但假如 <code>foo</code> 是 <code>null</code> 或 <code>undefined</code> ，x 等于 <code>bar()</code> 的计算结果。</p><p>同样的，上面的代码可以写出等价代码。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">foo </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> foo </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    foo </span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>当尝试使用默认值时，<code>??</code> 运算符可以代替 <code>||</code> 的作用。 例如，下面的代码片段尝试获取上一次储存在 <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage"><code>localStorage</code></a> 中的 volume（如果它已保存）; 但是因为使用了 <code>||</code> ，留下一个 bug。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">initializeAudio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> volume </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token property-access">volume</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token number">0.5</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>如果 <code>localStorage.volume</code> 的值是 <code>0</code>，这段代码将会把 volume 的值设置为 <code>0.5</code>，这是一个意外情况。 而 <code>??</code> 避免了将 <code>0</code>、<code>NaN</code> 和 <code>&quot;&quot;</code> 视为假值的意外情况。</p><p>我们非常感谢社区成员 <a target="_blank" rel="noopener noreferrer" href="https://github.com/Kingwl">Wenlu Wang<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://github.com/dragomirtitian">Titian Cernicova Dragomir<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现了这个特性！ 想了解更多细节，你可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/32883">查看他们的 PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://github.com/tc39/proposal-nullish-coalescing/">空值合并草案的 Repo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="断言函数"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#断言函数"><span class="icon icon-link"></span></a>断言函数</h2><p><a target="_blank" rel="noopener noreferrer" href="http://www.typescriptlang.org/play/#example/assertion-functions">Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>有一类特定的函数，用于在出现非预期结果时抛出一个错误。 这样的函数叫做“断言”函数（Assertion Function）。 比方说，Node.js 中就有一个名为 <code>assert</code> 的断言函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token plain">someValue </span><span class="token operator">===</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在上面的例子中，如果 <code>someValue</code> 不等于 42，那么 <code>assert</code> 就会抛出一个 <code>AssertionError</code> 错误。</p><p>在 JavaScript 中，断言经常被用于防止不正确传参。 举个例子：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token parameter punctuation">,</span><span class="token parameter"> y</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> x </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> y </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> x </span><span class="token operator">*</span><span class="token plain"> y</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>很遗憾，在 TypeScript 中，这些检查没办法正确编码。 对于类型宽松的代码，意味着 TypeScript 检查得更少，而对于更加规范的代码，通常迫使使用者添加类型断言。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> str </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> str</span><span class="token punctuation">.</span><span class="token method function property-access">toUppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 糟了！我们拼错了 &#x27;toUpperCase&#x27;。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 如果 TypeScript 依然能检查出来就太棒了！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>有一个替代的写法，可以让 TypeScript 能够分析出问题，不过这样并不方便。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> str </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;str should have been a string.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 发现错误！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> str</span><span class="token punctuation">.</span><span class="token method function property-access">toUppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>归根结底，TypeScript 的目标是以最小的改动为现存的 JavaScript 结构添加上类型声明。 因此，TypeScript 3.7 引入了一个称为“断言签名”的新概念，用于模拟这些断言函数。</p><p>第一种断言签名模拟了 Node 中 <code>assert</code> 函数的功能。 它确保在断言的范围内，无论什么判断条件都为必须真。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token plain">condition</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">,</span><span class="token plain"> msg</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">asserts</span><span class="token plain"> condition </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">condition</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">AssertionError</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p><code>asserts condition</code> 表示：如果 <code>assert</code> 函数成功返回，则传入的 <code>condition</code> 参数必须为真（否则它应该抛出一个 Error）。 这意味着对于同作用域中的后续代码，条件必须为真。 回到例子上，用这个断言函数意味着我们 <em>能够</em> 捕获之前 <code>yell</code> 示例中的错误。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> str </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> str</span><span class="token punctuation">.</span><span class="token method function property-access">toUppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//         ~~~~~~~~~~~</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// error: Property &#x27;toUppercase&#x27; does not exist on type &#x27;string&#x27;.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//        Did you mean &#x27;toUpperCase&#x27;?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token plain">condition</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">,</span><span class="token plain"> msg</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">asserts</span><span class="token plain"> condition </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">condition</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">AssertionError</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>另一种类型的断言签名不通过检查条件语句实现，而是在 TypeScript 里显式指定某个变量或属性具有不同的类型。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">assertIsString</span><span class="token punctuation">(</span><span class="token plain">val</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">asserts</span><span class="token plain"> val </span><span class="token keyword">is</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> val </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">AssertionError</span><span class="token punctuation">(</span><span class="token string">&quot;Not a string!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>这里的 <code>asserts val is string</code> 保证了在 <code>assertIsString</code> 调用之后，传入的任何变量都有可以被视为是 <code>string</code> 类型的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">assertIsString</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 现在 TypeScript 知道 &#x27;str&#x27; 是一个 &#x27;string&#x27;。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> str</span><span class="token punctuation">.</span><span class="token method function property-access">toUppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//         ~~~~~~~~~~~</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// error: Property &#x27;toUppercase&#x27; does not exist on type &#x27;string&#x27;.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//        Did you mean &#x27;toUpperCase&#x27;?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>这些断言方法签名类似于类型谓词（type predicate）签名：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">isString</span><span class="token punctuation">(</span><span class="token plain">val</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> val </span><span class="token keyword">is</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword">typeof</span><span class="token plain"> val </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> str</span><span class="token punctuation">.</span><span class="token method function property-access">toUppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token string">&quot;Oops!&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>就像类型谓词签名一样，这些断言签名具有清晰的表现力。 我们可以用它们表达一些非常复杂的想法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token generic-function function">assertIsDefined</span><span class="token generic-function generic class-name operator">&lt;</span><span class="token generic-function generic class-name constant">T</span><span class="token generic-function generic class-name operator">&gt;</span><span class="token punctuation">(</span><span class="token plain">val</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">asserts</span><span class="token plain"> val </span><span class="token keyword">is</span><span class="token plain"> </span><span class="token maybe-class-name">NonNullable</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">val </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> val </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">AssertionError</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Expected &#x27;val&#x27; to be defined, but received </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">val</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>想了解更多断言签名的细节，可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/32695">查看原始的 PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="更好地支持返回-never-的函数"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#更好地支持返回-never-的函数"><span class="icon icon-link"></span></a>更好地支持返回 <code>never</code> 的函数</h2><p>作为断言签名实现的一部分，TypeScript 需要编码更多关于调用位置和调用函数的细节。 这给了我们机会扩展对另一类函数的支持——返回 <code>never</code> 的函数。</p><p>返回 <code>never</code> 的函数，即永远不会返回的函数。 它表明抛出了异常、触发了停止错误条件、或程序退出的情况。 例如，<a target="_blank" rel="noopener noreferrer" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/5299d372a220584e75a031c13b3d555607af13f8/types/node/globals.d.ts#l874"><code>@types/node</code> 中的 <code>process.exit(...)</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 就被指定为返回 <code>never</code>。</p><p>为了确保函数永远不会潜在地返回 <code>undefined</code>、或者从所有代码路径中有效地返回，TypeScript 需要借助一些语法标志——函数结尾处的 <code>return</code> 或 <code>throw</code>。 这样，使用者就会发现自己的代码在“返回”一个停机函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">SomeType</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> x </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token function">doThingWithString</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> x </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token function">doThingWithNumber</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> process</span><span class="token punctuation">.</span><span class="token method function property-access">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>现在，这些返回 <code>never</code> 的函数被调用时，TypeScript 能识别出它们将影响代码执行流程，同时说明原因。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">SomeType</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> x </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token function">doThingWithString</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> x </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token function">doThingWithNumber</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    process</span><span class="token punctuation">.</span><span class="token method function property-access">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>你可以和在断言函数的 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/32695">同一个 PR 中查看更多细节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="更加递归的类型别名"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#更加递归的类型别名"><span class="icon icon-link"></span></a>（更加）递归的类型别名</h2><p><a target="_blank" rel="noopener noreferrer" href="http://www.typescriptlang.org/play/#example/recursive-type-references">Playground<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>类型别名在“递归”引用方面一直存在局限性。 原因是，类型别名必须能用它代表的东西来代替自己。 这在某些情况下是不可能的，因此编译器会拒绝某些递归别名，比如下面这个：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Foo</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Foo</span><span class="token punctuation">;</span></div></pre></div><p>这是一个合理的限制，因为任何对 <code>Foo</code> 的使用都可以替换为 <code>Foo</code>，同时这个 <code>Foo</code> 能够替换为 <code>Foo</code>，而这个 <code>Foo</code> 应该……（产生了无限循环）希望你理解到这个意思了！ 到最后，没有类型可以用来代替 <code>Foo</code>。</p><p><a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/w/index.php?title=Recursive_data_type&amp;oldid=913091335#in_type_synonyms">其他语言也是这么处理类型别名的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但是它确实会产生一些令人困惑的情形，影响类型别名的使用。 例如，在 TypeScript 3.6 和更低的版本中，下面的代码会报错：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">ValueOrArray</span><span class="token class-name operator">&lt;</span><span class="token class-name constant">T</span><span class="token class-name operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token constant">T</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator">&lt;</span><span class="token maybe-class-name">ValueOrArray</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//   ~~~~~~~~~~~~</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// error: Type alias &#x27;ValueOrArray&#x27; circularly references itself.</span></div></pre></div><p>这很令人困惑，因为使用者总是可以用接口来编写具有相同作用的代码，那么从技术上讲这没什么问题。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">ValueOrArray</span><span class="token class-name operator">&lt;</span><span class="token class-name constant">T</span><span class="token class-name operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token constant">T</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token maybe-class-name">ArrayOfValueOrArray</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">ArrayOfValueOrArray</span><span class="token class-name operator">&lt;</span><span class="token class-name constant">T</span><span class="token class-name operator">&gt;</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">Array</span><span class="token class-name operator">&lt;</span><span class="token class-name maybe-class-name">ValueOrArray</span><span class="token class-name operator">&lt;</span><span class="token class-name constant">T</span><span class="token class-name operator">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></pre></div><p>因为接口（以及其他对象 type）引入了一个间接的层级，并且它们的完整结构不需要立即建立，所以 TypeScript 可以处理这种结构。</p><p>但是，对于使用者而言，引入接口的方案并不直观。 并且，用了 <code>Array</code> 的初始版 <code>ValueOrArray</code> 没什么原则性问题。 如果编译器多一点“惰性”，并且只按需计算 <code>Array</code> 的类型参数，那么 TypeScript 就可以正确地表示出这些了。</p><p>这正是 TypeScript 3.7 引入的。 在类型别名的“顶层”，TypeScript 将推迟解析类型参数以便支持这些模式。</p><p>这意味着，用于表示 JSON 的以下代码……</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Json</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token maybe-class-name">JsonObject</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token maybe-class-name">JsonArray</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">JsonObject</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token plain">property</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Json</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">JsonArray</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">Array</span><span class="token class-name operator">&lt;</span><span class="token class-name maybe-class-name">Json</span><span class="token class-name operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></pre></div><p>终于可以重写成不需要借助 interface 的形式。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Json</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">property</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Json</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token maybe-class-name">Json</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><p>这个新的机制让我们在元组中，同样也可以递归地使用类型别名。 下面的 TypeScript 代码在以前会报错，但现在是合法的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">VirtualNode</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token maybe-class-name">VirtualNode</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> myNode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">VirtualNode</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;parent&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">[</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;first-child&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;I&#x27;m the first child&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">[</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;second-child&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;I&#x27;m the second child&quot;</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><p>想了解更多细节，你可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/33050">查看原始的 PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="--declaration-和---allowjs"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#--declaration-和---allowjs"><span class="icon icon-link"></span></a><code>--declaration</code> 和 <code>--allowJs</code></h2><p><code>--declaration</code> 选项允许我们从 TypeScript 源文件（诸如 <code>.ts</code> 和 <code>.tsx</code> 文件）生成 <code>.d.ts</code> 文件（声明文件）。<code>.d.ts</code> 文件的重要性有几个方面：</p><p>首先，它们使得 TypeScript 能够对外部项目进行类型检查，同时避免重复检查其源代码。 另一方面，它们使得 TypeScript 能够与现存的 JavaScript 库相互配合，即使这些库构建时并未使用 TypeScript。 最后，还有一个通常被忽略的好处：在使用支持 TypeScript 的编辑器时，TypeScript <em>和</em> JavaScript 使用者都可以从这些文件中受益，例如更高级的自动完成。</p><p>不幸的是，<code>--declaration</code> 不能与 <code>--allowJs</code> 选项一起使用，<code>--allowJs</code> 选项允许混合使用 TypeScript 和 JavaScript 文件。 这是一个令人沮丧的限制，因为它意味着使用者在迁移代码库时无法使用 <code>--declaration</code> 选项，即使代码包含了 JSDoc 注释。 TypeScript 3.7 对此进行了改进，允许这两个选项一起使用！</p><p>这个功能最大的影响可能比较微妙：在 TypeScript 3.7 中，编写带有 JSDoc 注释的 JavaScript 库，也能帮助 TypeScript 的使用者。</p><p>它的实现原理是，在启用 <code>allowJs</code> 时，TypeScript 会尽可能地分析并理解常见的 JavaScript 模式；然而，用 JavaScript 表达的某些模式看起来不一定像它们在 TypeScript 中的等效形式。 启用 <code>declaration</code> 选项后，TypeScript 会尽力识别 JSDoc 注释和 CommonJS 形式的模块输出，并转换为有效的类型声明输出到 <code>.d.ts</code> 文件上。</p><p>比如下面这个代码片段</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> assert </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;assert&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">blurImage</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> blurImage</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * Produces a blurred image from an input buffer.</span></div><div class="token-line"><span class="token comment"> * </span></div><div class="token-line"><span class="token comment"> * @param input {Uint8Array}</span></div><div class="token-line"><span class="token comment"> * @param width {number}</span></div><div class="token-line"><span class="token comment"> * @param height {number}</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">blurImage</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token parameter punctuation">,</span><span class="token parameter"> width</span><span class="token parameter punctuation">,</span><span class="token parameter"> height</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> numPixels </span><span class="token operator">=</span><span class="token plain"> width </span><span class="token operator">*</span><span class="token plain"> height </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> numPixels</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token plain">numPixels</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// TODO</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>将会生成如下 <code>.d.ts</code> 文件</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * Produces a blurred image from an input buffer.</span></div><div class="token-line"><span class="token comment"> *</span></div><div class="token-line"><span class="token comment"> * @param input {Uint8Array}</span></div><div class="token-line"><span class="token comment"> * @param width {number}</span></div><div class="token-line"><span class="token comment"> * @param height {number}</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">blurImage</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Uint8Array</span><span class="token punctuation">,</span><span class="token plain"> width</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token plain"> height</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Uint8Array</span><span class="token punctuation">;</span></div></pre></div><p>除了基本的带有 <code>@param</code> 标记的函数，也支持其他情形, 请看下面这个例子：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * @callback Job</span></div><div class="token-line"><span class="token comment"> * @returns {void}</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/** Queues work */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Worker</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">maxDepth </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter number">10</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">started</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">depthLimit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> maxDepth</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">         * NOTE: queued jobs may add more items to queue</span></div><div class="token-line"><span class="token comment">         * @type {Job[]}</span></div><div class="token-line"><span class="token comment">         */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Adds a work item to the queue</span></div><div class="token-line"><span class="token comment">     * @param {Job} work </span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">work</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">depthLimit</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Queue full!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Starts the queue if it has not yet started</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">started</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">started</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">/** @type {Job} */</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token method function property-access">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>会生成如下 <code>.d.ts</code> 文件：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * @callback Job</span></div><div class="token-line"><span class="token comment"> * @returns {void}</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/** Queues work */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Worker</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token plain">maxDepth</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    started</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    depthLimit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * NOTE: queued jobs may add more items to queue</span></div><div class="token-line"><span class="token comment">     * @type {Job[]}</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    queue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Job</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Adds a work item to the queue</span></div><div class="token-line"><span class="token comment">     * @param {Job} work</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">push</span><span class="token punctuation">(</span><span class="token plain">work</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Job</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Starts the queue if it has not yet started</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Job</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">;</span></div></pre></div><p>注意，当同时启用这两个选项时，TypeScript 不一定必须得编译成 <code>.js</code> 文件。 如果只是简单的想让 TypeScript 创建 <code>.d.ts</code> 文件，你可以启用 <code>--emitDeclarationOnly</code> 编译选项。</p><p>想了解更多细节，你可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/32372">查看原始的 PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="usedefineforclassfields-编译选项和-declare-属性修饰符"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#usedefineforclassfields-编译选项和-declare-属性修饰符"><span class="icon icon-link"></span></a><code>useDefineForClassFields</code> 编译选项和 <code>declare</code> 属性修饰符</h2><p>当在 TypeScript 中写类公共字段时，我们尽力保证以下代码</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name constant">C</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    bar</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>等价于构造函数中的相似语句</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name constant">C</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>不幸的是，虽然这符合该提案早期的发展方向，但类公共字段极有可能以不同的方式进行标准化。 所以取而代之的，原始代码示例可能需要进行脱糖处理，变成类似下面的代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name constant">C</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            enumerable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            configurable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            writable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">100</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            enumerable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            configurable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            writable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>当然，TypeScript 3.7 在默认情况下的编译结果与之前版本没有变化，我们增量地发布改动，以便帮助使用者减少未来潜在的破坏性变更。 我们提供了一个新的编译选项 <code>useDefineForClassFields</code>，根据一些新的检查逻辑使用上面这种编译模式。</p><p>最大的两个改变如下：</p><ul><li>声明通过 <code>Object.defineProperty</code> 完成。</li><li>声明 <em>总是</em> 被初始化为 <code>undefined</code>，即使原有代码中没有显式的初始值。</li></ul><p>对于现存的含有继承的代码，这可能会造成一些问题。首先，基类的 <code>set</code> 访问器不再被触发——它们将被完全覆写。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Base</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">set</span><span class="token plain"> </span><span class="token function">data</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;data changed to &quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Derived</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Base</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 当启用 &#x27;useDefineForClassFields&#x27; 时</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 不再触发 &#x27;console.log&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>其次，基类中的属性设定也将不起作用。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Animal</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> animalStuff</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Dog</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Animal</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> dogStuff</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AnimalHouse</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    resident</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token plain">animal</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">resident</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> animal</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">DogHouse</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AnimalHouse</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 当启用 &#x27;useDefineForClassFields&#x27; 时</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 调用 &#x27;super()&#x27; 后</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// &#x27;resident&#x27; 只会被初始化成 &#x27;undefined&#x27;！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    resident</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Dog</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token plain">dog</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Dog</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">dog</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>这两个问题归结为，继承时混合覆写属性与访问器，以及属性不带初始值的重新声明。</p><p>为了检测这个访问器的问题，TypeScript 3.7 现在可以在 <code>.d.ts</code> 文件中编译出 <code>get</code>/<code>set</code>，这样 TypeScript 就能检查出访问器覆写的情况。</p><p>对于改变类字段的代码，将字段初始化写成构造函数内的语句，就可以解决此问题。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Base</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">set</span><span class="token plain"> </span><span class="token function">data</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;data changed to &quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Derived</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Base</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>而解决第二个问题，你可以显式地提供一个初始值，或添加一个<code>declare</code> 修饰符来表示这个属性不要被编译。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Animal</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> animalStuff</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Dog</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Animal</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> dogStuff</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AnimalHouse</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    resident</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token plain">animal</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">resident</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> animal</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">DogHouse</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AnimalHouse</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">declare</span><span class="token plain"> resident</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Dog</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//  ^^^^^^^</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &#x27;resident&#x27; now has a &#x27;declare&#x27; modifier,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// and won&#x27;t produce any output code.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token plain">dog</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Dog</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">dog</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>目前，只有当编译目标是 ES5 及以上时 <code>useDefineForClassFields</code> 才可用，因为 ES3 中不支持 <code>Object.defineProperty</code>。 要检查类似的问题，你可以创建一个分离的项目，设定编译目标为 ES5 并使用 <code>--noEmit</code> 来避免完全构建。</p><p>想了解更多细节，你可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/33509">去原始的 PR 查看这些改动<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>我们强烈建议使用者尝试 <code>useDefineForClassFields</code>，并在 issues 或下面的评论区域中提供反馈。 应该碰到编译选项在使用难度上的反馈，这样我们就能够了解如何使迁移变得更容易。</p><h2 id="利用项目引用实现无构建编辑"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#利用项目引用实现无构建编辑"><span class="icon icon-link"></span></a>利用项目引用实现无构建编辑</h2><p>TypeScript 的项目引用功能，为我们提供了一种简单的方法来分解代码库，从而使编译速度更快。 遗憾的是，当我们编辑一个依赖未曾构建（或者构建结果过时）的项目时，体验不好。</p><p>在 TypeScript 3.7 中，当打开一个带有依赖的项目时，TypeScript 将自动切换为使用依赖中的 <code>.ts</code>/<code>.tsx</code> 源码文件。 这意味着在带有外部引用的项目中，代码的修改会即时同步和生效，编码体验会得到提升。 你也可以适当地打开编译器选项 <code>disableSourceOfProjectReferenceRedirect</code> 来禁用这个引用的功能，因为在超大型项目中这个功能可能会影响性能。</p><p>你可以 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/32028">阅读这个 PR 来了解这个改动的更多细节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="检查未调用的函数"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#检查未调用的函数"><span class="icon icon-link"></span></a>检查未调用的函数</h2><p>一个常见且危险的错误是：忘记调用一个函数，特别是当该函数不需要参数，或者它的命名容易被误认为是一个属性而不是函数时。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">User</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">isAdministrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    doNotDisturb</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 之后…</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 有问题的代码，别用！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">doAdminThing</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 糟了！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">.</span><span class="token property-access">isAdministrator</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">sudo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">editTheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">AccessDeniedError</span><span class="token punctuation">(</span><span class="token string">&quot;User is not an admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>在这段代码中，我们忘了调用 <code>isAdministrator</code>，导致该代码错误地允许非管理员用户修改配置！</p><p>在 TypeScript 3.7 中，它会被识别成一个潜在的错误：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">doAdminThing</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">.</span><span class="token property-access">isAdministrator</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//  ~~~~~~~~~~~~~~~~~~~~</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// error! This condition will always return true since the function is always defined.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//        Did you mean to call it instead?</span></div></pre></div><p>这个检查功能是一个破坏性变更，基于这个因素，检查会非常保守。 因此对这类错误的提示仅限于 <code>if</code> 条件语句中。当问题函数是可选属性、或未开启 <code>strictNullChecks</code> 选项、或该函数在 <code>if</code> 的代码块中有被调用，在这些情况下不会被视为错误：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">User</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">isAdministrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    doNotDisturb</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">issueNotification</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">.</span><span class="token property-access">doNotDisturb</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// OK，属性是可选的</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">.</span><span class="token property-access">notify</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// OK，调用了该函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        user</span><span class="token punctuation">.</span><span class="token method function property-access">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>如果你打算对该函数进行测试但不调用它，你可以修改它的类型定义，让它可能是 <code>undefined</code>/<code>null</code>，或使用 <code>!!</code> 来编写类似 <code>if (!!user.isAdministrator)</code> 的代码，表示代码逻辑确实是这样的。</p><p>我们非常感谢社区成员 <a target="_blank" rel="noopener noreferrer" href="https://github.com/jwbay">@jwbay<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 提出了 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/32802">这个问题的概念<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 并持续跟进实现了 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/33178">这个需求的当前版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="typescript-文件中的--ts-nocheck"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#typescript-文件中的--ts-nocheck"><span class="icon icon-link"></span></a>TypeScript 文件中的 <code>// @ts-nocheck</code></h2><p>TypeScript 3.7 允许我们在 TypeScript 文件的顶部添加一行 <code>// @ts-nocheck</code> 注释来关闭语义检查。 这个注释原本只在 <code>checkJs</code> 选项启用时的 JavaScript 源文件中有效，但我们扩展了它，让它能够支持 TypeScript 文件，这样所有使用者在迁移的时候会更方便。</p><h2 id="分号格式化选项"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#分号格式化选项"><span class="icon icon-link"></span></a>分号格式化选项</h2><p>JavaScript 有一个自动分号插入（ASI，automatic semicolon insertion）规则，TypeScript 内置的格式化程序现在能支持在可选的尾分号位置插入或删除分号。该设置现在在 <a target="_blank" rel="noopener noreferrer" href="https://code.visualstudio.com/insiders/">Visual Studio Code Insiders<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，以及 Visual Studio 16.4 Preview 2 中的“工具选项”菜单中可用。</p><img width="833" alt="New semicolon formatter option in VS Code" src="https://user-images.githubusercontent.com/3277153/65913194-10066e80-e395-11e9-8a3a-4f7305c397d5.png"/><p>将值设定为 “insert” 或 “remove” 同时也会影响自动导入、类型提取、以及其他 TypeScript 服务提供的自动生成代码的格式。将设置保留为默认值 “ignore” 可以使生成代码的分号自动配置匹配当前文件的风格。</p><h2 id="37-的破坏性变更"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#37-的破坏性变更"><span class="icon icon-link"></span></a>3.7 的破坏性变更</h2><h3 id="dom-变更"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#dom-变更"><span class="icon icon-link"></span></a>DOM 变更</h3><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/33627"><code>lib.dom.d.ts</code> 中的类型声明已更新<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 这些变更大部分是与空值检查有关的检测准确性变更，最终的影响取决于你的代码库。</p><h3 id="类字段处理"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#类字段处理"><span class="icon icon-link"></span></a>类字段处理</h3><p><a href="/typescript//release-notes/typescript-3_7#usedefineforclassfields-%e7%bc%96%e8%af%91%e9%80%89%e9%a1%b9%e5%92%8c-declare-%e5%b1%9e%e6%80%a7%e4%bf%ae%e9%a5%b0%e7%ac%a6">正如上文提到的</a>，TypeScript 3.7 现在能够在 <code>.d.ts</code> 文件中编译出 <code>get</code>/<code>set</code>，这可能对 3.5 和更低版本的 TypeScript 使用者来说是破坏性变更。 TypeScript 3.6 的使用者不会受影响，因为该版本对这个功能已经进行了预兼容。</p><p><code>useDefineForClassFields</code> 选项虽然自身没有破坏性变更，但不排除以下情形：</p><ul><li>在派生类中用属性声明覆盖了基类的访问器</li><li>覆盖声明属性，但是没有初始值</li></ul><p>要了解全部的影响，请查看 <a href="/typescript//release-notes/typescript-3_7#usedefineforclassfields-%e7%bc%96%e8%af%91%e9%80%89%e9%a1%b9%e5%92%8c-declare-%e5%b1%9e%e6%80%a7%e4%bf%ae%e9%a5%b0%e7%ac%a6">上面关于 <code>useDefineForClassFields</code> 的章节</a>。</p><h3 id="函数真值检查"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#函数真值检查"><span class="icon icon-link"></span></a>函数真值检查</h3><p>正如上文提到的，现在当函数在 <code>if</code> 条件语句中未被调用时 TypeScript 会报错。 当 <code>if</code> 条件语句中判断的是函数时将会报错，除非符合以下情形：</p><ul><li>该函数是可选属性</li><li>未开启 <code>strictNullChecks</code> 选项</li><li>该函数在 <code>if</code> 的代码块中有被调用</li></ul><h3 id="本地和导入的类型声明现在会产生冲突"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#本地和导入的类型声明现在会产生冲突"><span class="icon icon-link"></span></a>本地和导入的类型声明现在会产生冲突</h3><p>TypeScript 之前有一个 bug，导致允许以下代码结构：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// ./someOtherModule.ts</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">SomeType</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    y</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ./myModule.ts</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">SomeType</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./someOtherModule&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">SomeType</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    x</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">SomeType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// Error! &#x27;x&#x27; doesn&#x27;t exist on &#x27;SomeType&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>这里，<code>SomeType</code> 同时来源于 <code>import</code> 声明和本地 <code>interface</code> 声明。 出人意料的是，在模块内部，<code>SomeType</code> 只会指向 <code>import</code> 的定义，而本地声明的 <code>SomeType</code> 仅在另一个文件的导入中起效。 这很令人困惑，我们对类似的个例进行的调查表明，广大开发者通常理解的情况不一样。</p><p>在 TypeScript 3.7 中，<a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/31231">这个问题中的重复声明现在可以被正确地识别为一个错误<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 合理的修复方案取决于开发者的原始意图，并应该逐案解决。 通常，命名冲突不是故意的，最好的办法是重命名导入的那个类型。 如果是要扩展导入的类型，则可以编写模块扩展（module augmentation）来代替。</p><h3 id="37-api-变化"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-3_7#37-api-变化"><span class="icon icon-link"></span></a>3.7 API 变化</h3><p>为了实现上文中提到的递归的类型别名模式，<code>TypeReference</code> 接口已经移除了 <code>typeArguments</code> 属性。开发者应该在 <code>TypeChecker</code> 实例上使用 <code>getTypeArguments</code> 函数来代替。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/onlyxhb/typescript/edit/master/zh/release-notes/typescript-3_7.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2/23/2022 18:39:43</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/typescript/umi.07b86845.js"></script>
  </body>
</html>
