<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/typescript/umi.8c6752e0.css" />
    <script>
      window.routerBase = "/typescript/";
    </script>
    <script>
      //! umi version: 3.5.20
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>TypeScript 4.2 - TypeScript手册</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/release-notes/typescript-4_2" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/typescript//">TypeScript手册</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/typescript//tutorials">介绍</a></span><span><a href="/typescript//handbook">基础</a></span><span><a href="/typescript//reference">进阶</a></span><span><a href="/typescript//handbook-v2">字面量类型</a></span><span><a href="/typescript//declaration-files">声明文件</a></span><span><a href="/typescript//javascript">类型检查-JS</a></span><span><a href="/typescript//project-config">工程配置</a></span><span><a href="/typescript//wiki">Wiki</a></span><span><a aria-current="page" class="active" href="/typescript//release-notes">新增</a></span><span><a href="/typescript//breaking-changes">改动</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/onlyxhb/typescript">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/typescript//"></a><h1>TypeScript手册</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/typescript//tutorials">介绍</a></li><li><a href="/typescript//handbook">基础</a></li><li><a href="/typescript//reference">进阶</a></li><li><a href="/typescript//handbook-v2">字面量类型</a></li><li><a href="/typescript//declaration-files">声明文件</a></li><li><a href="/typescript//javascript">类型检查-JS</a></li><li><a href="/typescript//project-config">工程配置</a></li><li><a href="/typescript//wiki">Wiki</a></li><li><a aria-current="page" class="active" href="/typescript//release-notes">新增</a></li><li><a href="/typescript//breaking-changes">改动</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/onlyxhb/typescript">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/typescript//release-notes">新增</a></li><li><a href="/typescript//release-notes/typescript-1_1">TypeScript 1.1</a></li><li><a href="/typescript//release-notes/typescript-1_3">TypeScript 1.3</a></li><li><a href="/typescript//release-notes/typescript-1_4">TypeScript 1.4</a></li><li><a href="/typescript//release-notes/typescript-1_5">TypeScript 1.5</a></li><li><a href="/typescript//release-notes/typescript-1_6">TypeScript 1.6</a></li><li><a href="/typescript//release-notes/typescript-1_7">TypeScript 1.7</a></li><li><a href="/typescript//release-notes/typescript-1_8">TypeScript 1.8</a></li><li><a href="/typescript//release-notes/typescript-2_0">TypeScript 2.0</a></li><li><a href="/typescript//release-notes/typescript-2_1">TypeScript 2.1</a></li><li><a href="/typescript//release-notes/typescript-2_2">TypeScript 2.2</a></li><li><a href="/typescript//release-notes/typescript-2_3">TypeScript 2.3</a></li><li><a href="/typescript//release-notes/typescript-2_4">TypeScript 2.4</a></li><li><a href="/typescript//release-notes/typescript-2_5">TypeScript 2.5</a></li><li><a href="/typescript//release-notes/typescript-2_6">TypeScript 2.6</a></li><li><a href="/typescript//release-notes/typescript-2_7">TypeScript 2.7</a></li><li><a href="/typescript//release-notes/typescript-2_8">TypeScript 2.8</a></li><li><a href="/typescript//release-notes/typescript-2_9">TypeScript 2.9</a></li><li><a href="/typescript//release-notes/typescript-3_0">TypeScript 3.0</a></li><li><a href="/typescript//release-notes/typescript-3_1">TypeScript 3.1</a></li><li><a href="/typescript//release-notes/typescript-3_2">TypeScript 3.2</a></li><li><a href="/typescript//release-notes/typescript-3_3">TypeScript 3.3</a></li><li><a href="/typescript//release-notes/typescript-3_4">TypeScript 3.4</a></li><li><a href="/typescript//release-notes/typescript-3_5">TypeScript 3.5</a></li><li><a href="/typescript//release-notes/typescript-3_6">TypeScript 3.6</a></li><li><a href="/typescript//release-notes/typescript-3_7">TypeScript 3.7</a></li><li><a href="/typescript//release-notes/typescript-3_8">TypeScript 3.8</a></li><li><a href="/typescript//release-notes/typescript-3_9">TypeScript 3.9</a></li><li><a href="/typescript//release-notes/typescript-4_0">TypeScript 4.0</a></li><li><a href="/typescript//release-notes/typescript-4_1">TypeScript 4.1</a></li><li><a aria-current="page" class="active" href="/typescript//release-notes/typescript-4_2">TypeScript 4.2</a></li><li><a href="/typescript//release-notes/typescript-4_3">TypeScript 4.3</a></li><li><a href="/typescript//release-notes/typescript-4_4">TypeScript 4.4</a></li><li><a href="/typescript//release-notes/typescript-4_5">TypeScript 4.5</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="更智能地保留类型别名" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#更智能地保留类型别名"><span>更智能地保留类型别名</span></a></li><li title="元组类型中前导的/中间的剩余元素" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#元组类型中前导的中间的剩余元素"><span>元组类型中前导的/中间的剩余元素</span></a></li><li title="更严格的 in 运算符检查" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#更严格的-in-运算符检查"><span>更严格的 in 运算符检查</span></a></li><li title="--noPropertyAccessFromIndexSignature" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#--nopropertyaccessfromindexsignature"><span>--noPropertyAccessFromIndexSignature</span></a></li><li title="abstract 构造签名" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#abstract-构造签名"><span>abstract 构造签名</span></a></li><li title="使用 --explainFiles 来理解工程的结构" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#使用---explainfiles-来理解工程的结构"><span>使用 --explainFiles 来理解工程的结构</span></a></li><li title="改进逻辑表达式中的未被调用函数检查" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#改进逻辑表达式中的未被调用函数检查"><span>改进逻辑表达式中的未被调用函数检查</span></a></li><li title="解构出来的变量可以被明确地标记为未使用的" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#解构出来的变量可以被明确地标记为未使用的"><span>解构出来的变量可以被明确地标记为未使用的</span></a></li><li title="放宽了在可选属性和字符串索引签名间的限制" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#放宽了在可选属性和字符串索引签名间的限制"><span>放宽了在可选属性和字符串索引签名间的限制</span></a></li><li title="声明缺失的函数" data-depth="2"><a href="/typescript//release-notes/typescript-4_2#声明缺失的函数"><span>声明缺失的函数</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="typescript-42"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#typescript-42"><span class="icon icon-link"></span></a>TypeScript 4.2</h1><h2 id="更智能地保留类型别名"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#更智能地保留类型别名"><span class="icon icon-link"></span></a>更智能地保留类型别名</h2><p>在 TypeScript 中，使用类型别名能够给某个类型起个新名字。 倘若你定义了一些函数，并且它们全都使用了 <code>string | number | boolean</code> 类型，那么你就可以定义一个类型别名来避免重复。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">BasicPrimitive</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span></div></pre></div><p>TypeScript 使用了一系列规则来推测是否该在显示类型时使用类型别名。 例如，有如下的代码。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">BasicPrimitive</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">BasicPrimitive</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> x</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>如果在 Visual Studio，Visual Studio Code 或者 <a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/play?ts=4.1.3#code/KYDwDg9gTgLgBDAnmYcBCBDAzgSwMYAKUOAtjjDgG6oC8cAdgK4kBGwUcAPnFjMfQHMucFhAgAbYBnoBuAFBzQkWHABmjengoR6cACYQAyjEarVACkoZxjYAC502fEVLkqwAJRwA3nLj+4SXgQODorG2B5ALgoYBMoXRB5AF8gA">TypeScript 演练场<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>编辑器中把鼠标光标放在 <code>x</code> 上，我们就会看到信息面板中显示出了 <code>BasicPrimitive</code> 类型。 同样地，如果我们查看由该文件生成的声明文件（<code>.d.ts</code>），那么 TypeScript 会显示出 <code>doStuff</code> 的返回值类型为 <code>BasicPrimitive</code> 类型。</p><p>那么你猜一猜，如果返回值类型为 <code>BasicPrimitive</code> 或 <code>undefined</code> 时会发生什么？</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">BasicPrimitive</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">BasicPrimitive</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> value</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>可以在<a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/play?ts=4.1.3#code/KYDwDg9gTgLgBDAnmYcBCBDAzgSwMYAKUOAtjjDgG6oC8cAdgK4kBGwUcAPnFjMfQHMucFhAgAbYBnoBuALAAoRQHplcABIRqHCPTgByACYQAyjEYAzC-pHBxEAO4IIPYKgcALDPAAqyYCZ4xGDwhjhYYOIYiFhwFtAIHqhQwOZQekgoAHQqagDqqGQCHvBe1HCgKHgwwIZw5M5wYPzw2Lm5cJ2YuITEZBTl3Iz0hsAWOPS1HR0sjPBs9k5+KIHB8AAsWQBMADT18BO8UnVhEVExcG0Kqh2dTKzswrz8QtyiElJ6QyNjE1PXykUlWg8Asw2qOF0cGMZksFgAFJQMOJGMAAFzobD4IikchUYAASjgAG9FJ1yTgLHB4QBZbweLJQaTGEjwokAHjgAAYsgBWImkhTk4WdFJpPTDUbjSaGeRC4UAX0UZOFYsY6TgSJRwDlcAVQA">TypeScript 4.1 演练场<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中查看结果。 虽然我们希望 TypeScript 将 <code>doStuff</code> 的返回值类型显示为 <code>BasicPrimitive | undefined</code>，但是它却显示成了 <code>string | number | boolean | undefined</code> 类型！ 这是怎么回事？</p><p>这与 TypeScript 内部的类型表示方式有关。 当基于一个联合类型来创建另一个联合类型时，TypeScript 会将类型<em>标准化</em>，也就是把类型展开为一个新的联合类型 - 但这么做也可能会丢失信息。 类型检查器不得不根据 <code>string | number | boolean | undefined</code> 类型来尝试每一种可能的组合并查看使用了哪些类型别名，即便这样也可能会有多个类型别名指向 <code>string | number | boolean</code> 类型。</p><p>TypeScript 4.2 的内部实现更加智能了。 我们会记录类型是如何被构造的，会记录它们原本的编写方式和之后的构造方式。 我们同样会记录和区分不同的类型别名！</p><p>有能力根据类型使用的方式来回显这个类型就意味着，对于 TypeScript 用户来讲能够避免显示很长的类型；同时也意味着会生成更友好的 <code>.d.ts</code> 声明文件、错误消息和编辑器内显示的类型及签名帮助信息。 这会让 TypeScript 对于初学者来讲更友好一些。</p><p>更多详情，请参考<a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/42149">PR：改进保留类型别名的联合<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，以及<a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/42284">PR：保留间接的类型别名<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="元组类型中前导的中间的剩余元素"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#元组类型中前导的中间的剩余元素"><span class="icon icon-link"></span></a>元组类型中前导的/中间的剩余元素</h2><p>在 TypeScript 中，元组类型用于表示固定长度和元素类型的数组。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 存储了一对数字的元组</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 存储了一个string，一个number和一个boolean的元组</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><p>随着时间的推移，TypeScript 中的元组类型变得越来越复杂，因为它们也被用来表示像 JavaScript 中的参数列表类型。 结果就是，它可能包含可选元素和剩余元素，以及用于工具和提高可读性的标签。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 包含一个或两个元素的元组。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> c</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token operator">?</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">c </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;world&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 包含一个或两个元素的标签元组。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> d</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">first</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> second</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">d </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;world&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 包含剩余元素的元组 - 至少前两个元素是字符串，</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 以及后面的任意数量的布尔元素。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token builtin">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">e </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;world&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">e </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;world&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">e </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;world&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><p>在 TypeScript 4.2 中，剩余元素会按它们的使用方式进行展开。 在之前的版本中，TypeScript 只允许 <code>...rest</code> 元素位于元组的末尾。</p><p>但现在，剩余元素可以出现在元组中的任意位置 - 但有一点限制。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> foo</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;hello!&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;hello!&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;hello!&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> bar</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token builtin">boolean</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">bar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">bar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;some text&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">bar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;some&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;separated&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;text&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><p>唯一的限制是，剩余元素之后不能出现可选元素或其它剩余元素。 换句话说，一个元组中只允许有一个剩余元素，并且剩余元素之后不能有可选元素。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Clown</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/*...*/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Joker</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/*...*/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token maybe-class-name">StealersWheel</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token maybe-class-name">Clown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;me&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token maybe-class-name">Joker</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//                                    ~~~~~~~~~~ 错误</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token maybe-class-name">StringsAndMaybeBoolean</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token operator">?</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//                                        ~~~~~~~~ 错误</span></div></pre></div><p>这些不在结尾的剩余元素能够用来描述，可接收任意数量的前导参数加上固定数量的结尾参数的函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">declare</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token plain">names</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> shouldCapitalize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token comment">/*shouldCapitalize:*/</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token string">&#x27;fee&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;fi&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;fo&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;fum&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">/*shouldCapitalize:*/</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>尽管 JavaScript 中没有声明前导剩余参数的语法，但我们仍可以将 <code>doStuff</code> 函数的参数声明为带有前导剩余元素 <code>...args</code> 的元组类型。 使用这种方式可以帮助我们描述许多的 JavaScript 代码！</p><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/41544">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="更严格的-in-运算符检查"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#更严格的-in-运算符检查"><span class="icon icon-link"></span></a>更严格的 <code>in</code> 运算符检查</h2><p>在 JavaScript 中，如果 <code>in</code> 运算符的右操作数是非对象类型，那么会产生运行时错误。 TypeScript 4.2 确保了该错误能够在编译时被捕获。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token string">&#x27;foo&#x27;</span><span class="token plain"> </span><span class="token keyword">in</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// The right-hand side of an &#x27;in&#x27; expression must not be a primitive.</span></div></pre></div><p>这个检查在大多数情况下是相当保守的，如果你看到提示了这个错误，那么代码中很可能真的有问题。</p><p>非常感谢外部贡献者 <a target="_blank" rel="noopener noreferrer" href="https://github.com/jonhue">Jonas Hübotter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/41928">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>！</p><h2 id="--nopropertyaccessfromindexsignature"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#--nopropertyaccessfromindexsignature"><span class="icon icon-link"></span></a><code>--noPropertyAccessFromIndexSignature</code></h2><p>在 TypeScript 刚开始支持索引签名时，它只允许使用方括号语法来访问索引签名中定义的元素，例如 <code>person[&quot;name&quot;]</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">SomeType</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/** 这是索引签名 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token plain">propName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">SomeType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation">[</span><span class="token string">&#x27;someProperty&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>这就导致了在处理带有任意属性的对象时变得烦锁。 例如，假设有一个容易出现拼写错误的 API，容易出现在属性名的末尾位置多写一个字母 <code>s</code> 的错误。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Options</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/** 要排除的文件模式。 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    exclude</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * 这会将其余所有未声明的属性定义为 &#x27;any&#x27; 类型。</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token plain">x</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">processOptions</span><span class="token punctuation">(</span><span class="token plain">opts</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 注意，我们想要访问 `excludes` 而不是 `exclude`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">opts</span><span class="token punctuation">.</span><span class="token property-access">excludes</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token string">&#x27;The option `excludes` is not valid. Did you mean `exclude`?&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>为了便于处理以上情况，在从前的时候，TypeScript 允许使用点语法来访问通过字符串索引签名定义的属性。 这会让从 JavaScript 代码到 TypeScript 代码的迁移工作变得容易。</p><p>然而，放宽限制同样意味着更容易出现属性名拼写错误。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Options</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/** 要排除的文件模式。 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    exclude</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * 这会将其余所有未声明的属性定义为 &#x27;any&#x27; 类型。</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token plain">x</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ---cut---</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">processOptions</span><span class="token punctuation">(</span><span class="token plain">opts</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 注意，我们不小心访问了错误的 `excludes`。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 但是！这是合法的！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">const</span><span class="token plain"> excludePattern </span><span class="token keyword">of</span><span class="token plain"> opts</span><span class="token punctuation">.</span><span class="token property-access">excludes</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>在某些情况下，用户会想要选择使用索引签名 - 在使用点号语法进行属性访问时，如果访问了没有明确定义的属性，就得到一个错误。</p><p>这就是为什么 TypeScript 引入了一个新的 <code>--noPropertyAccessFromIndexSignature</code> 编译选项。 在该模式下，你可以有选择的启用 TypeScript 之前的行为，即在上述使用场景中产生错误。 该编译选项不属于 <code>strict</code> 编译选项集合的一员，因为我们知道该功能只适用于部分用户。</p><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/40171/">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 我们同时要感谢 <a target="_blank" rel="noopener noreferrer" href="https://github.com/Kingwl">Wenlu Wang<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 为该功能的付出！</p><h2 id="abstract-构造签名"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#abstract-构造签名"><span class="icon icon-link"></span></a><code>abstract</code> 构造签名</h2><p>TypeScript 允许将一个类标记为 <em>abstract</em>。 这相当于告诉 TypeScript 这个类只是用于继承，并且有些成员需要在子类中实现，以便能够真正地创建出实例。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Shape</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 不能创建抽象类的实例</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Square</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Shape</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    #sideLength</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token plain">sideLength</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">#sideLength</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> sideLength</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">#sideLength</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 没问题</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Square</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>为了能够确保一贯的对 <code>new</code> 一个 <code>abstract</code> 类进行限制，不允许将 <code>abstract</code> 类赋值给接收构造签名的值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Shape</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">HasArea</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 不能将抽象构造函数类型赋值给非抽象构造函数类型。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token maybe-class-name">Ctor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">HasArea</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Shape</span><span class="token punctuation">;</span></div></pre></div><p>如果有代码调用了 <code>new Ctor</code>，那么上述的行为是正确的，但若想要编写 <code>Ctor</code> 的子类，就会出现过度限制的情况。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Shape</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">HasArea</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">makeSubclassWithArea</span><span class="token punctuation">(</span><span class="token maybe-class-name">Ctor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">HasArea</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name keyword">extends</span><span class="token plain"> </span><span class="token maybe-class-name">Ctor</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 不能将抽象构造函数类型赋值给非抽象构造函数类型。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token maybe-class-name">MyShape</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">makeSubclassWithArea</span><span class="token punctuation">(</span><span class="token maybe-class-name">Shape</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>对于内置的工具类型<code>InstanceType</code>来讲，它也不是工作得很好。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 错误！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 不能将抽象构造函数类型赋值给非抽象构造函数类型。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">MyInstance</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">InstanceType</span><span class="token operator">&lt;</span><span class="token keyword">typeof</span><span class="token plain"> </span><span class="token maybe-class-name">Shape</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></div></pre></div><p>这就是为什么 TypeScript 4.2 允许在构造签名上指定 <code>abstract</code> 修饰符。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Shape</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ---cut---</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">HasArea</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// Works!</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token maybe-class-name">Ctor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">HasArea</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Shape</span><span class="token punctuation">;</span></div></pre></div><p>在构造签名上添加 <code>abstract</code> 修饰符表示可以传入一个 <code>abstract</code> 构造函数。 它不会阻止你传入其它具体的类/构造函数 - 它只是想表达不会直接调用这个构造函数，因此可以安全地传入任意一种类类型。</p><p>这个特性允许我们编写支持抽象类的<em>混入工厂函数</em>。 例如，在下例中，我们可以同时使用混入函数 <code>withStyles</code> 和 <code>abstract</code> 类 <code>SuperClass</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">SuperClass</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">badda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AbstractConstructor</span><span class="token class-name operator">&lt;</span><span class="token class-name constant">T</span><span class="token class-name operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token constant">T</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token generic-function function">withStyles</span><span class="token generic-function generic class-name operator">&lt;</span><span class="token generic-function generic class-name constant">T</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword">extends</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name maybe-class-name">AbstractConstructor</span><span class="token generic-function generic class-name operator">&lt;</span><span class="token generic-function generic class-name">object</span><span class="token generic-function generic class-name operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token maybe-class-name">Ctor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">StyledClass</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">Ctor</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">getStyles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token maybe-class-name">StyledClass</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name">SubClass</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">withStyles</span><span class="token punctuation">(</span><span class="token maybe-class-name">SuperClass</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>注意，<code>withStyles</code> 展示了一个特殊的规则，若一个类（<code>StyledClass</code>）继承了被抽象构造函数所约束的泛型值，那么这个类也需要被声明为 <code>abstract</code>。 由于无法知道传入的类是否拥有更多的抽象成员，因此也无法知道子类是否实现了所有的抽象成员。</p><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/36392">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="使用---explainfiles-来理解工程的结构"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#使用---explainfiles-来理解工程的结构"><span class="icon icon-link"></span></a>使用 <code>--explainFiles</code> 来理解工程的结构</h2><p>TypeScript 用户时常会问“为什么 TypeScript 包含了这个文件？”。 推断程序中所包含的文件是个很复杂的过程，比如有很多原因会导致使用了 <code>lib.d.ts</code> 文件的组合，会导致 <code>node_modules</code> 中的文件被包含进来，会导致有些已经 <code>exclude</code> 的文件被包含进来。</p><p>这就是 TypeScript 提供 <code>--explainFiles</code> 的原因。</p><div class="__dumi-default-code-block"><pre class="prism-code language-sh"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">tsc --explainFiles</span></div></pre></div><p>在使用了该选项时，TypeScript 编译器会输出非常详细的信息来说明某个文件被包含进工程的原因。 为了更易理解，我们可以把输出结果存到文件里，或者通过管道使用其它命令来查看它。</p><div class="__dumi-default-code-block"><pre class="prism-code language-sh"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># 将输出保存到文件</span></div><div class="token-line"><span class="token plain">tsc --explainFiles &gt; expanation.txt</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"># 将输出传递给工具程序 `less`，或编辑器 VS Code</span></div><div class="token-line"><span class="token plain">tsc --explainFiles | less</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">tsc --explainFiles | code -</span></div></pre></div><p>通常，输出结果首先会给列出包含 <code>lib.d.ts</code> 文件的原因，然后是本地文件，再然后是 <code>node_modules</code> 文件。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es5.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es5&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.es2015.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es2015.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es2015&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.es2016.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es2016.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es2016&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.es2017.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es2017.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es2017&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.es2018.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es2018.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es2018&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.es2019.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es2019.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es2019&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.es2020.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.es2020.d.ts</span></div><div class="token-line"><span class="token plain">  Library referenced via &#x27;es2020&#x27; from file &#x27;TS_Compiler_Directory/4.2.2/lib/lib.esnext.d.ts&#x27;</span></div><div class="token-line"><span class="token plain">TS_Compiler_Directory/4.2.2/lib/lib.esnext.d.ts</span></div><div class="token-line"><span class="token plain">  Library &#x27;lib.esnext.d.ts&#x27; specified in compilerOptions</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">... More Library References...</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">foo.ts</span></div><div class="token-line"><span class="token plain">  Matched by include pattern &#x27;**/*&#x27; in &#x27;tsconfig.json&#x27;</span></div></pre></div><p>目前，TypeScript 不保证输出文件的格式 - 它在将来可能会改变。 关于这一点，我们也打算改进输出文件格式，请给出你的建议！</p><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/40011">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>！</p><h2 id="改进逻辑表达式中的未被调用函数检查"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#改进逻辑表达式中的未被调用函数检查"><span class="icon icon-link"></span></a>改进逻辑表达式中的未被调用函数检查</h2><p>感谢 <a target="_blank" rel="noopener noreferrer" href="https://github.com/a-tarasyuk">Alex Tarasyuk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 提供的持续改进，TypeScript 中的未调用函数检查现在也作用于 <code>&amp;&amp;</code> 和 <code>||</code> 表达式。</p><p>在 <code>--strictNullChecks</code> 模式下，下面的代码会产生错误。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">shouldDisplayElement</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Element</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getVisibleItems</span><span class="token punctuation">(</span><span class="token plain">elements</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Element</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> elements</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> shouldDisplayElement </span><span class="token operator">&amp;&amp;</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//                          ~~~~~~~~~~~~~~~~~~~~</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 该条件表达式永远返回 true，因为函数永远是定义了的。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 你是否想要调用它？</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/issues/40197">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="解构出来的变量可以被明确地标记为未使用的"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#解构出来的变量可以被明确地标记为未使用的"><span class="icon icon-link"></span></a>解构出来的变量可以被明确地标记为未使用的</h2><p>感谢 <a target="_blank" rel="noopener noreferrer" href="https://github.com/a-tarasyuk">Alex Tarasyuk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 提供的另一个 PR，你可以使用下划线（<code>_</code> 字符）将解构变量标记为未使用的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">_first</span><span class="token punctuation">,</span><span class="token plain"> second</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在之前，如果 <code>_first</code> 未被使用，那么在启用了 <code>noUnusedLocals</code> 时 TypeScript 会产生一个错误。 现在，TypeScript 会识别出使用了下划线的 <code>_first</code> 变量是有意的未使用的变量。</p><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/41378">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="放宽了在可选属性和字符串索引签名间的限制"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#放宽了在可选属性和字符串索引签名间的限制"><span class="icon icon-link"></span></a>放宽了在可选属性和字符串索引签名间的限制</h2><p>字符串索引签名可用于为类似于字典的对象添加类型，它表示允许使用任意的键来访问对象：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> movieWatchCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">watchMovie</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    movieWatchCount</span><span class="token punctuation">[</span><span class="token plain">title</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">movieWatchCount</span><span class="token punctuation">[</span><span class="token plain">title</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">??</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>当然了，对于不在字典中的电影名而言 <code>movieWatchCount[title]</code> 的值为 <code>undefined</code>。（TypeScript 4.1 增加了 <a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#checked-indexed-accesses---nouncheckedindexedaccess"><code>--noUncheckedIndexedAccess</code></a> 选项，在访问索引签名时会增加 <code>undefined</code> 值。） 即便一定会有 <code>movieWatchCount</code> 中不存在的属性，但在之前的版本中，由于 <code>undefined</code> 值的存在，TypeScript 会将可选对象属性视为不可以赋值给兼容的索引签名。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">WesAndersonWatchCount</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;Fantastic Mr. Fox&#x27;</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;The Royal Tenenbaums&#x27;</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;Moonrise Kingdom&#x27;</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;The Grand Budapest Hotel&#x27;</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">declare</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> wesAndersonWatchCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">WesAndersonWatchCount</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> movieWatchCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> wesAndersonWatchCount</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//    ~~~~~~~~~~~~~~~ 错误！</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 类型 &#x27;WesAndersonWatchCount&#x27; 不允许赋值给类型 &#x27;{ [key: string]: number; }&#x27;。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//    属性 &#x27;&quot;Fantastic Mr. Fox&quot;&#x27; 与索引签名不兼容。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//      类型 &#x27;number | undefined&#x27; 不允许赋值给类型 &#x27;number&#x27;。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//        类型 &#x27;undefined&#x27; 不允许赋值给类型 &#x27;number&#x27;。 (2322)</span></div></pre></div><p>TypeScript 4.2 允许这样赋值。 但是不允许使用带有 <code>undefined</code> 类型的非可选属性进行赋值，也不允许将 <code>undefined</code> 值直接赋值给某个属性：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">BatmanWatchCount</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string-property property">&#x27;Batman Begins&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string-property property">&#x27;The Dark Knight&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string-property property">&#x27;The Dark Knight Rises&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">declare</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> batmanWatchCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">BatmanWatchCount</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 在 TypeScript 4.2 中仍是错误。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> movieWatchCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> batmanWatchCount</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 在 TypeScript 4.2 中仍是错误。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 索引签名不允许显式地赋值 `undefined`。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">movieWatchCount</span><span class="token punctuation">[</span><span class="token string">&quot;It&#x27;s the Great Pumpkin, Charlie Brown&quot;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span></div></pre></div><p>这条新规则不适用于数字索引签名，因为它们被当成是类数组的并且是稠密的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">declare</span><span class="token plain"> </span><span class="token keyword">let</span><span class="token plain"> sortOfArrayish</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">declare</span><span class="token plain"> </span><span class="token keyword">let</span><span class="token plain"> numberKeys</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token number">42</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">sortOfArrayish </span><span class="token operator">=</span><span class="token plain"> numberKeys</span><span class="token punctuation">;</span></div></pre></div><p>更多详情，请参考 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/41921">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="声明缺失的函数"><a aria-hidden="true" tabindex="-1" href="/typescript//release-notes/typescript-4_2#声明缺失的函数"><span class="icon icon-link"></span></a>声明缺失的函数</h2><p>感谢 <a target="_blank" rel="noopener noreferrer" href="https://github.com/a-tarasyuk">Alexander Tarasyuk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 提交的 <a target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/pull/41215">PR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，TypeScript 支持了一个新的快速修复功能，那就是根据调用方来生成新的函数和方法声明！</p><p><img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2021/01/addMissingFunction-4.2.gif" alt="一个未被声明的 foo 函数被调用了，使用快速修复"/></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/onlyxhb/typescript/edit/master/zh/release-notes/typescript-4_2.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2/23/2022 18:39:43</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/typescript/umi.07b86845.js"></script>
  </body>
</html>
